<!doctype html>

<html lang="en">

<head>
  <title>Western Watersheds</title>

  <!--Requried meta tags-->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
  <!-- Animate CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alegreya+Sans+SC|Roboto" rel="stylesheet">>
  <!-- Storymap CSS -->
  <link rel="stylesheet" type="text/css" href="css/storymap.2.5.css">

  <!-- Add favicon for the web page -->
  <!--<link rel="icon" href="/images/favicon.ico" type="image/x-icon">-->

  <style>
    .feature-label {
      font-family: 'Roboto', sans-serif;
      color: black;
      font-size: 12px;
      font-weight: bold;
      text-shadow: 0 0 3pm #ffffff;
      background-color: rgba(0, 0, 0, 0);
      border: none;
      box-shadow: none;
    }

    .feature-tooltip {
      font-family: 'Roboto', sans-serif;
      color: black;
      font-size: 14px;
      font-weight: lighter;
    }

    .glyphicon-one-fine-smaller-dot:before {
      content: "\25cf";
      font-size: 1em;
    }

    .glow-effect {
      color: rgba(0, 255, 0, .6);
      text-shadow: 0 0 10pm rgb(0, 255, 0);
    }
  </style>

</head>

<body>

  <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark storymap-navbar">
    <a class="navbar-brand navbar-custom" href="#">
      <!--convert the style value to a class and then add the class to the css file.-->
      <!--<img src="img/logo.png" class="d-inline-block align-top">-->
      Water Reclamation Projects & Biodiversity
    </a>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse">
      <!--Create class ml-auto for the navbar items you want on the right.-->
      <ul class="navbar-nav ml-auto"></ul>
    </div>
  </nav>

  <div class="container">
    <h1>Water Reclamation Projects & Biodiversity</h1>
    <h2>in Western Watersheds</h2>
  </div>

  <div id="storymap" class="container-fluid">
    <div class="row">
      <div class="col-sm-6 col-md-4 storymap-story">
        <section data-scene="scene1">
          <h2>Organizing Water</h2>
          <p>Watersheds provide a structure to the way we understand how water exists in and moves through the
            environment.
            It's an area of land in which streams and precipitation drain into a common outlet. It
            includes all surface and underlying groundwater. Watershed boundaries follow the highest ridgeline around
            the stream
            drainage area and converge at the lowest point where water flows out of the watershed.</p>
          <p>Watersheds exist on several scales. For reporting and research purposes, they are organized into nested
            hydrologic units (HUC).</p>
          <li>22 regional watersheds (HUC2)</li>
          <li>223 sub-regions (HUC4)</li>
          <li>387 basins (HUC6)</li>
          <li>2,318 sub-basins (HUC8)</li>
          <br>
          <p>By the late eighties, the emergence of GIS permitted federal agencies to further divide
            the sub-basins into watersheds that could be used to examine trends and patterns on more local levels.</p>
          <li>18,586 watersheds (HUC10)</li>
          <li>101,534 sub-watersheds (HUC12)</li>
          </p>
          <p>The map to the right shows the highest levels of watershreds in the United States. If you look closely, you
            can see a major river crossing through the middle of each of these regions.
          </p> <br><i>Source:<a
              href="https://www.nrcs.usda.gov/wps/portal/nrcs/detail/national/water/watersheds/dataset/?cid=nrcs143_021617"
              target="_blank"> USDA Natural Resources Conservation Services</a></i>
          </p>
        </section>
        <section data-scene="scene2">
          <h2>...in the West</h2>
          <p>The American West is a diverse region with mountains, plains, deserts, and canyons, but it is united by two
            things: lack of preciptiation and a bounty of open space. The lack of precipitation presented unique water
            management challenges. Initially, settlers diverted water from streams to support agriculture, but as demand
            outweighed supply settlers pressured the federal government to undertake water storage and irrigation
            projects. Explorer and scholar of the West, John Wesley Powell, recognized the unique water needs and
            proposed
            a river-basin/watershed-based approach to water management in the West, but it was not enough to prevent the
            grid pattern that organized the East from reaching West.</p>
          <p>The first western water reclamation projects were privately funded and often failed due to inadequate
            funding and expertise. The federal government finally intervened with the passage of the Reclamation
            Act in 1902. Western water management found its first home at the US Geological Survey, and was moved to an
            independent bureau within the Department of the Interior by 1907. By 1923, the agency was known as the
            Bureau of Reclamation (USBR) and by 1928, federal funds began flowing through the agency for major projects
            like the Hoover Dam. The abundance of open space in the west helped to facilitate the system of large water
            developments that we see today.</p>
          <p>Imagine how different states would look if they were structured around water management issues. This map
            shows sub-regions (HUC4) for the four westernmost watersheds in the continental US.</p>
          <br><i>Source:<a href="http://waterinthewest.stanford.edu/sites/default/files/Final_WaterintheWest_CJPP.pdf"
              target="_blank"> Water in the West</a></i>
          <br><i>Source:<a href="https://www.usbr.gov/history/borhist.html" target="_blank"> USBR History</a></i>
        </section>
        <section data-scene="scene3">
          <h2>Everyone is in charge</h2>
          <p>In 1878, John Wesley Powell proposed managing water-needs by creating watersheds-as-political-jurisditions.
            Watersheds form the best hydrological planning units for land, water, and ecosystem management....and yet,
            in the United States, one watershed can be regulated/managed by multiple state, county, and city agencies
            with conflicting interests and needs. One connected stream can be subject to multiple water quality
            regulations, stormwater ordinances, fishing licenses regulations based on government offices.</p>
          <p>Because political boundaries do not mirror those of watersheds, the management of water resources
            requires a substantial amount of interagency coordination. This map shows watersheds at a river-basin level.
            You can see that a number of them cross state lines and city metro areas cover multiple river-basins.
            Things are not much cleaner or clearer on data collecting level.
            The subcommittee on Spatial Water Data alone includes members from the Natural Resources Conservation
            Service, USGS, Forest Service, BLM, Corps of Engineers, EPA, FEMA, NOAA, and NWS.</p>
          <br><i>Source:<a href="https://aquadoc.typepad.com/files/watershed-usa.pdf" target="_blank"> What if... the
              United States of American were based on Watersheds?</a></i>
        </section>
        <section data-scene="scene4">
          <h2>Health & At-Risk Species</h2>
          <p>All land drains into a lake, river, stream or other water body and directly affects its quality, so
            anything that water encounters upstream impacts everything downstream. The EPA is one of many governmental
            agencies that collects and measures attributes of watersheds. Specifically, the EPA tracks watershed health
            based on six ecological attributes:
            <li>Landscape Condition</li>
            <li>Habitat</li>
            <li>Hydrology</li>
            <li>Water Quality</li>
            <li>Biological Condition</li>
            <br>When watersheds are not healthy, wildlife suffers. Pollutants introduced to the ecosystem alter
            habitats. This reduced biodiversity by eliminating some species and introducing new, invasive ones that
            destroy native species. This, in turn, can affect the food chain. Freshwater ecosystems are tighly linked to
            watersheds and they are greatly influenced by human uses or mofications of land as well as water.
          </p>
          <p>This map shows the number of at-risk terrestrial, wetland, and aquatic species by sub-basins. At-risk
            species are defined as species that are listed under the US Endangered Species Act and species that have a
            NatureServe conservation rank of critically imperiled.</p>
          <br><i>Source: <a href="https://www.epa.gov/hwp" target="_blank">EPA Healthy Watersheds Program</a></i>
        </section>
        <section data-scene="scene5">
          <h2>Supplying water to arid areas</h2>
          <p>The Bureau of Reclamation is best known for dams, powerplants, and canals that facilitated the economic
            developement of the West. Today, the USBR is the largest wholesaler of water in the US. 10 million acres of
            farmland are irrigated by reclamation water. One out of ever five farmers in the American West are served by
            reclamation water. 25% of the nation's fruit and nut crop and 60% of the nation's vegetables are produced
            using reclamation water. The USBR is responsible for 338 reservoirs, 492 dams, and 8,116 miles of irrigation
            canals.</p>
          <p>Shown here are USBR sites where data is collected for the Reclamation Water Information System. While
            there is not a clear pattern between the point locations and areas that have a large number of at-risk
            species, there does seem to be something happening near the Lake Berryessa/Monitcello Dam project near
            San Franciscso.</p>
          <br><i>Source:<a href="https://www.usbr.gov/main/about/fact.html" target="_blank"> USBR Fact Sheet</a></i>
          </p>
        </section>
        <section data-scene="scene6">
          <h2>Lake Berryessa & Monticello Dam</h2>
          <p><i>In 1948, the federal government had to choose between saving Berryessa Valley for farming or flooding it
              to benefit neighboring Solano. Napa County touted the valley’s 12,000 acres as some of the most fertile in
              California. But in the eyes of the dam builders, the U.S. Bureau of Reclamation, Devil’s Gate was one of
              the best dam sites in the entire Central Valley.<br>--Peter Jensen</i>
            <br><i>Source:<a
                href="https://napavalleyregister.com/news/local/the-year-they-flooded-an-agrarian-paradise/article_63b286fe-e825-11e1-9d12-001a4bcf887a.html"
                target="_blank">Napa Register, August 10, 2012</a></i></p>
          <p>In the winter of 1957, the 300-foot-high Monticello Dam was complete at Devil’s Gate. Napa County
            lost one-eighth of its farmland. The decision to flood Berryessa Valley reflected California’s insatiable
            need for water, its most precious resource. Water from the reservoir supplies agriculture downstream. In
            1983, the Monticello Dam Powerplant was added to the project. Power is sent to the North Bay Area.
            <img class="img-fluid" src="./images/MonticelloDam.jpg" alt="Monticello Dam">
            By <a rel="nofollow" class="external text" href="https://www.flickr.com/people/47026734@N08">Bureau of
              Reclamation</a> - <a rel="nofollow" class="external text"
              href="https://www.flickr.com/photos/usbr/12207537394/">Montecello Dam</a>, <a
              href="https://creativecommons.org/licenses/by-sa/2.0"
              title="Creative Commons Attribution-Share Alike 2.0">CC BY-SA 2.0</a>, <a
              href="https://commons.wikimedia.org/w/index.php?curid=50462312">Link</a>
        </section>
        <section data-scene="scene7">
          <h2>Ecological Impact</h2>
          <p>The EPA reports on 460 watershed indicators at the sub-watershed (HUC12) level in the Watershed Index
            Online tool. These indicators are divided into four categories: base, ecological indicators, stressor
            indicators, and social indicators. The following scenes explore data
            points in each of these categories for the purpose of examining the health of the sub-watersheds surrounding
            Lake Berryessa and the Monticello Dam to see if an inference can be drawn between the presence of a major
            water reclamation project and the high number of at-risk species.</p>
          <p>A watershed's ecological index score changes based on the factors selected, where higher scores represent a
            healthier watershed. The ecologic index score for this map was developed by using the following measures:
            <li>% Forest Change from 2001 to 2011</li>
            <li>% N-Index1: % of the land classified as natural cover</li>
            <li>Habitat Condition Index: high scores indicate that there is a low likelihood
              of aquatic habitat degredation based on land use, population density, point-source pollution sites, and
              other measures</li>
            <li>PHWA Health Index: high scores correspond to greater potential for a watershed to support a healthy
              aquatic ecosystem</li>
            <li>% NEF Hubs: % of land that is classified as a priority landscape by the National Ecological Framework
              (NEF)</li>
            <li>% Rare Ecosystem</li>
            <li> At-risk species (Aquatic, Terrestrial, Wetlands)</li>
          </p>
        </section>
        <section data-scene="scene8">
          <h2>Stressors</h2>
          <p>A watershed's stressor index score changes based on the factors selected, where higher scores represent a
            a less healthy watershed. The stressor index score for this map was developed by using the following
            measures:
            <li>% Urban</li>
            <li>% Urban change from 2011 to 2011</li>
            <li>% Agriculture</li>
            <li>% Agriculture Change</li>
            <li>Count of Mines</li>
            <li>% Rare Ecosystem</li>
            <li>Density of Roads</li>
            <li>Count of Road-Stream Crossings</li>
            <li>% Agriculture contiguous to water</li>
            <li>% Urban contiguous to water</li>
            <li>Empower density: standardized measure for quantifying the intensity of human activity</li>
            <li>PHWA Watershed Vulnerabilty Index: higher scores correspond to more vulnerable watersheds</li>
            <li>Population</li>
            <li>Population Density</li>
            <li>Count of Dams</li>
          </p>
        </section>
        <section data-scene="scene9">
          <h2>Social Impact</h2>
          <p>Social indicators for watersheds are typically things like the percent protected lands or societal traits
            that have a positive impact on a watershed. This social index measures the percentage of each watershed that
            is classified as GAP Status 1, 2, or 3. Status 1 lands have permanent protection from conversion of natural
            land cover and a mandated management plan to maintain a natural state. Status 2 lands must maintain a
            primarily natural state. Status 3 lands are defined as having permanent protection, but are subject to
            extractive uses like logging or mining.</p>
        </section>
        <section data-scene="scene10">
          <h2>Resources</h2>
          <p>There is a tremendous amount of data being collected to measure the health of watersheds. The readily
            available WSIO data on which much of this map is based is centered around measurements for local
            sub-watersheds and does not account for upstream measurements that most certainly impact downstream
            watersheds. While this map was unable to directly connect water reclamation projects to biodiversity issues,
            it was helpful in illustrating the fragility of western watersheds
          </p>
          <p>Major Data Resources:
            <li><a href="https://datagateway.nrcs.usda.gov/GDGOrder.aspx?order=MBROrder" target="_blank">GeoSpatial Data
                Gateway</a></li>
            <li><a href="http://www.natureserve.org/conservation-tools/biotics-5" target="_blank">NatureServe Biotics
                Database</a></li>
            <li><a href="https://water.usbr.gov" target="_blank">Reclamation Water Information System</a></li>
            <li><a href="https://www.epa.gov/wsio" target="_blank">Watershed Index Online</a></li>
          </p>
        </section>
      </div>
      <div class="col-sm-6 col-md-8 storymap-map"></div>
    </div>
  </div>

  <!-- Add libraries -->
  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.4.0.min.js"
    integrity="sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg=" crossorigin="anonymous"></script>
  <!-- Popper.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
  </script>
  <!-- Boostrap -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
  </script>
  <!-- Leaflet.ajax for asynchronously adding geojson data -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
  <!-- Chroma Lib -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.0.3/chroma.min.js"></script>
  <!-- Storymap Plugin-->
  <script src="js/storymap.2.4.js"></script>
  <!-- d3 -->
  <script src="https://d3js.org/d3.v5.js"></script>

  <script type="text/javascript">
    // Load data using d3, promise //

    var nationalwatersheds = d3.json('./data/us-huc2.geojson');
    var watershedshuc2 = d3.json('./data/watersheds-huc2.geojson');
    var watershedshuc4 = d3.json('./data/watersheds-huc4.geojson');
    var watershedshuc6 = d3.json('./data/watersheds-huc6.geojson');
    var epahuc8 = d3.json('./data/epa-huc8.geojson');
    var usbr = d3.json('./data/usbrpoints.geojson');
    var hydro1 = d3.json('./data/hydro1.geojson');
    var hydro2 = d3.json('./data/hydro2.geojson');
    var station = d3.json('./data/station.geojson');
    var casestudy = d3.json('./data/case_study.geojson');

    Promise.all([nationalwatersheds, watershedshuc2, watershedshuc4, watershedshuc6, epahuc8, usbr, hydro1, hydro2,
      station,
      casestudy
    ]).then(ready);

    function ready(data) {

      var nationalwatershedsdata = data[0];
      var watershedshuc2data = data[1];
      var watershedshuc4data = data[2];
      var watershedshuc6data = data[3];
      var epahuc8data = data[4];
      var usbrdata = data[5];
      var hydro1data = data[6];
      var hydro2data = data[7];
      var stationdata = data[8];
      var casestudydata = data[9];

      /// Scene One ///
      var national_legend = '<i style="background: black; opacity: 0.5"></i><p><b>Regions (HUC2)</b></p>';
      var national = L.geoJson(nationalwatershedsdata, {
        style: function (feature) {
          return {
            color: '#dddddd',
            weight: .75,
            fillOpacity: .25,
            fillColor: '#2888ce'
          };
        },
        onEachFeature: function (feature, layer) {
          layer.bindTooltip(feature.properties.NAME + "<br>" + "HUC2: " +
            feature.properties.HUC2, {
              sticky: true,
              className: "feature-tooltip"
            });
          layer.on('mouseover', function () {
            layer.setStyle({
              weight: 2,
              fillOpacity: .7
            })
            layer.on('mouseout', function () {
              layer.setStyle({
                weight: 1,
                fillOpacity: .25
              })
            })
          })
        }
      });

      /// Scene Two ///
      var huc2_legend = '<i style="background: black; opacity: 0.5"></i><p><b>Regions (HUC2)</b></p>';
      var huc2 = L.geoJson(watershedshuc2data, {
        style: function (feature) {
          return {
            color: '#dddddd',
            weight: .75,
            fillOpacity: .25,
            fillColor: '#2888ce'
          };
        }
      });
      var huc4_legend = '<i style="background: black; opacity: 0.5"></i><p><b>Sub-Regions (HUC4)</b></p>';
      var huc4 = L.geoJson(watershedshuc4data, {
        style: function (feature) {
          return {
            color: '#dddddd',
            weight: .5,
            fillOpacity: .2,
            fillColor: '#1f78b4'
          };
        },
        onEachFeature: function (feature, layer) {
          layer.bindTooltip(feature.properties.Name + "<br>" + "HUC4: " +
            feature.properties.HUC4, {
              sticky: true,
              className: "feature-tooltip"
            });
          layer.on('mouseover', function () {
            layer.setStyle({
              weight: 2,
              fillOpacity: .6
            })
            layer.on('mouseout', function () {
              layer.setStyle({
                weight: 1,
                fillOpacity: .25
              })
            })
          })
        }
      });

      /// Scene Three ///
      var huc6_legend = '<i style="background: black; opacity: 0.5"></i><p><b>River-Basin (HUC6)</b></p>';
      var huc6 = L.geoJson(watershedshuc6data, {
        style: function (feature) {
          return {
            color: '#dddddd',
            weight: .5,
            fillOpacity: .3,
            fillColor: '#1f78b4'
          };
        },
        onEachFeature: function (feature, layer) {
          layer.bindTooltip(feature.properties.Name + "<br>" + "HUC6: " +
            feature.properties.HUC6, {
              sticky: true,
              className: "feature-tooltip"
            });
          layer.on('mouseover', function () {
            layer.setStyle({
              weight: 1,
              fillOpacity: .6
            })
            layer.on('mouseout', function () {
              layer.setStyle({
                weight: .25,
                fillOpacity: .3
              })
            })
          })
        }
      });

      /// Scene Four ///
      // Style Choropleth Map
      function setColor(total) {
        // Tenary operation: condition ? valueIfTrue : valueIfFalse
        return total > 29 ? '#b30000' :
          total > 17 ? '#e34a33' :
          total > 9 ? '#fc8d59' :
          total > 4 ? '#fdcc8a' :
          '#fef0d9';
      }
      // Set style function that sets fill color property
      function style(feature) {
        return {
          fillColor: setColor(feature.properties.total),
          fillOpacity: 0.5,
          weight: .5,
          opacity: .8,
          color: '#ffffff',
        };
      }
      var epa_choropleth = L.geoJson(epahuc8data, {
        style: style,
        onEachFeature: function (feature, layer) {
          layer.bindTooltip(feature.properties.Name + "<br> " + "Total At Risk Species: " + feature.properties
            .total, {
              className: 'feature-tooltip',
              permanent: false,
              direction: 'right'
            });
          layer.on('mouseover', function () {
            layer.setStyle({
              weight: 1,
              fillOpacity: .8
            })
            layer.on('mouseout', function () {
              layer.setStyle({
                weight: .5,
                fillOpacity: .5
              })
            })
          })
        },
      });
      var epa_choropleth_legend = '<p><b># of At Risk Species</b></p>' +
        '<i style="background: #fef0d9; opacity: 0.5"></i><p><b>0 - 4</b></p>' +
        '<i style="background: #fdcc8a; opacity: 0.5"></i><p><b>5 - 9</b></p>' +
        '<i style="background: #fc8d59; opacity: 0.5"></i><p><b>10 - 17</b></p>' +
        '<i style="background: #e34a33; opacity: 0.5"></i><p><b>18 - 29</b></p>' +
        '<i style="background: #b30000; opacity: 0.5"></i><p><b>30 - 49</b></p>';

      /// Scene Five ///
      var usbr_legend = '<i style="background: black; opacity: 0.5"></i><p><b>USBR Water Reclamation Projects</b></p>';
      var usbr = L.geoJson(usbrdata, {
        pointToLayer: function (feature, latlng) {
          return L.circle(latlng, {
            radius: 20000,
            fillColor: '#ffffff',
            fillOpacity: 0.5,
            stroke: true,
            weight: 1.5,
            opacity: 0.8,
            color: '#ffffff',
          });
        },
        onEachFeature: function (feature, layer) {
          layer.bindTooltip(feature.properties.description + "<br>" + "Type: " +
            feature.properties.type, {
              sticky: true,
              className: "feature-tooltip"
            });
        }
      });

      /// Scene Six ///
      var case_study_6_legend =
        '<i style="background: black; opacity: 0.5"></i><p><b>Water Monitoring Station</b></p>';
      var case_study_6 = L.geoJson(stationdata, {
        pointToLayer: function (feature, latlng) {
          return L.circle(latlng, {
            radius: 1000,
            fillColor: '#FFD700',
            fillOpacity: 0.4,
            stroke: true,
            weight: .5,
            opacity: 0.8,
            color: '#ffffff',
          });
        },
        onEachFeature: function (feature, layer) {
          layer.bindTooltip(feature.properties.Station + "<br>" + "Agency: " +
            feature.properties.Agency, {
              sticky: true,
              className: "feature-tooltip"
            });
        }
      });

      var hydro = L.geoJson(hydro1data, {
        style: function (feature) {
          return {
            color: '#f5f5f5',
            weight: .25,
            fillOpacity: .75,
            fillColor: '#0099bf'
          };
        },
      });
      var hydro2_legend = '<i style="background: black; opacity: 0.5"></i><p><b>Water</b></p>';
      var hydro2 = L.geoJson(hydro2data, {
        style: function (feature) {
          return {
            color: '#f5f5f5',
            weight: .5,
            fillOpacity: .75,
            fillColor: '#0099bf'
          };
        },
        onEachFeature: function (feature, layer) {
          layer.bindTooltip(feature.properties.Name + "<br>" + "Type: " +
            feature.properties.Feature, {
              sticky: true,
              className: "feature-tooltip"
            });
        }
      });
      /// Scene Seven ///
      function setColor7(Ecologic) {
        // Tenary operation: condition ? valueIfTrue : valueIfFalse
        return Ecologic > .4165 ? '#006837' :
          Ecologic > .3262 ? '#31a354' :
          Ecologic > .2758 ? '#78c679' :
          Ecologic > .2130 ? '#c2e699' :
          '#ffffee';
      }
      // Set style function that sets fill color property
      function style7(feature) {
        return {
          fillColor: setColor7(feature.properties.Ecologic),
          fillOpacity: 0.5,
          weight: .5,
          opacity: 0.8,
          color: '#ffffff',
        };
      }
      var case_study_7 = L.geoJson(casestudydata, {
        style: style7,
        onEachFeature: function (feature, layer) {
          layer.bindTooltip(feature.properties.SUBWTRSHED + "<br>" + "Region: " + feature.properties
            .NameHUC8Watershed + "<br>" + "Habitat Condition Index: " + feature.properties
            .HabitatConditionIndexWS2015 + "<br>" +
            "At Risk Aquatic Species: " + feature.properties.CountofAquaticSpecies + "<br>" +
            "At Risk Wetlands Species: " + feature.properties.CountofWetlandsSpecies + "<br>" +
            "At Risk Terrestrial Species: " + feature.properties.CountofTerrestrialSpecies, {
              className: 'feature-tooltip',
              permanent: false,
              direction: 'right'
            });
        }
      });
      var case_study_legend_7 = '<p><b>Habitat Condition Index</b></p>' +
        '<i style="background: #ffffee; opacity: 0.5"></i><p><b>.0935 - .2129</b></p>' +
        '<i style="background: #c2e699; opacity: 0.5"></i><p><b>.2130 - .2757</b></p>' +
        '<i style="background: #78c679; opacity: 0.5"></i><p><b>.2758 - .3261</b></p>' +
        '<i style="background: #31a354; opacity: 0.5"></i><p><b>.3262 - .4164</b></p>' +
        '<i style="background: #006837; opacity: 0.5"></i><p><b>.4165 - .6326</b></p>';

      /// Scene Eight///
      // style choropleth case study map
      function setColor8(Stressor) {
        // Tenary operation: condition ? valueIfTrue : valueIfFalse
        return Stressor > .29 ? '#bd0026' :
          Stressor > .2 ? '#f03b20' :
          Stressor > .14 ? '#fd8d3c' :
          Stressor > .09 ? '#fecc5c' :
          '#ffffb2';
      }
      // Set style function that sets fill color property
      function style8(feature) {
        return {
          fillColor: setColor8(feature.properties.Stressor),
          fillOpacity: 0.5,
          weight: .5,
          opacity: 0.8,
          color: '#ffffff',
        };
      }
      var case_study_8 = L.geoJson(casestudydata, {
        style: style8,
        onEachFeature: function (feature, layer) {
          layer.bindTooltip(feature.properties.SUBWTRSHED + "<br>" + "Stressors Index: " + feature.properties
            .Stressor + "<br>" + "Population:" + feature.properties.PopulationinWS + "<br>" +
            "Count of Road-Stream Crossings: " + feature.properties.CountroadstreamCrossings2015 + "<br>" +
            "% Agriculture Next to Water: " + feature.properties.AgricultureContiguoustoWaterinWS2011 + "<br>" +
            "% Urban Next to Water: " + feature.properties.UrbanContiguoustoWaterinWS2011 + "<br>" +
            "Count of Mines: " + feature.properties.CountAllMininginWS, +"<br>" + "Number of Dams: " + feature
            .properties.CountofDamsinWS, {
              className: 'feature-tooltip',
              permanent: false,
              direction: 'right'
            });
        }
      });
      var case_study_legend_8 = '<p><b>Watershed Stressor Index</b></p>' +
        '<i style="background: #ffffb2; opacity: 0.5"></i><p><b>.04 - .09 </b></p>' +
        '<i style="background: #fecc5c; opacity: 0.5"></i><p><b>.1 - .14</b></p>' +
        '<i style="background: #fd8d3c; opacity: 0.5"></i><p><b>.15 - .2</b></p>' +
        '<i style="background: #f03b20; opacity: 0.5"></i><p><b>.21 - .29</b></p>' +
        '<i style="background: #bd0026; opacity: 0.5"></i><p><b>.3 - .5</b></p>';

      /// Scene Nine///
      // style choropleth case study map
      function setColor9(Social) {
        // Tenary operation: condition ? valueIfTrue : valueIfFalse
        return Social > .438 ? '#810f7c' :
          Social > .331 ? '#8856a7' :
          Social > .249 ? '#8c96c6' :
          Social > .192 ? '#b3cde3' :
          '#edf8fb';
      }
      // Set style function that sets fill color property
      function style9(feature) {
        return {
          fillColor: setColor9(feature.properties.Social),
          fillOpacity: 0.5,
          weight: .5,
          opacity: 0.8,
          color: '#ffffff',
        };
      }
      var case_study_9 = L.geoJson(casestudydata, {
        style: style9,
        onEachFeature: function (feature, layer) {
          layer.bindTooltip(feature.properties.SUBWTRSHED + "<br>" + "Social Index: " + feature.properties
            .Social + "<br>" + "GAP Protection: " + feature.properties.GAPStatus123, {
              className: 'feature-tooltip',
              permanent: false,
              direction: 'right'
            });
        }
      });
      var case_study_legend_9 = '<p><b>Watershed Social Index</b></p>' +
        '<i style="background: #edf8fb; opacity: 0.5"></i><p><b>.167 - .191</b></p>' +
        '<i style="background: #b3cde3; opacity: 0.5"></i><p><b>.192 - .248</b></p>' +
        '<i style="background: #8c96c6; opacity: 0.5"></i><p><b>.249 - .330</b></p>' +
        '<i style="background: #8856a7; opacity: 0.5"></i><p><b>.331 - .437</b></p>' +
        '<i style="background: #810f7c; opacity: 0.5"></i><p><b>.438 - .500</b></p>';

      /// Scene Ten ///
      var national_legend = '<i style="background: black; opacity: 0.5"></i><p><b>HUC2</b></p>';
      var national = L.geoJson(nationalwatershedsdata, {
        style: function (feature) {
          return {
            color: '#dddddd',
            weight: .75,
            fillOpacity: .25,
            fillColor: '#2888ce'
          };
        },
        onEachFeature: function (feature, layer) {
          layer.bindTooltip(feature.properties.NAME + "<br>" + "HUC2: " +
            feature.properties.HUC2, {
              sticky: true,
              className: "feature-tooltip"
            });
          layer.on('mouseover', function () {
            layer.setStyle({
              weight: 2,
              fillOpacity: .7
            })
            layer.on('mouseout', function () {
              layer.setStyle({
                weight: 1,
                fillOpacity: .25
              })
            })
          })
        }
      });

      /// End of Scenes ///

      var darkLayer = L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png');

      var layers = {
        national: {
          layer: national,
          legend: national_legend
        },
        huc2: {
          layer: huc2,
          legend: huc2_legend
        },
        huc4: {
          layer: huc4,
          legend: huc4_legend
        },
        huc6: {
          layer: huc6,
          legend: huc6_legend
        },
        epa_choropleth: {
          layer: epa_choropleth,
          legend: epa_choropleth_legend
        },
        usbr: {
          layer: usbr,
          legend: usbr_legend
        },
        case_study_6: {
          layer: case_study_6,
          legend: case_study_6_legend
        },
        hydro: {
          layer: hydro,
        },
        hydro2: {
          layer: hydro2,
          legend: hydro2_legend
        },
        case_study_7: {
          layer: case_study_7,
          legend: case_study_legend_7
        },
        case_study_8: {
          layer: case_study_8,
          legend: case_study_legend_8
        },
        case_study_9: {
          layer: case_study_9,
          legend: case_study_legend_9
        }
      }

      var scenes = {
        scene1: {
          lat: 39.5,
          lng: -105.35,
          zoom: 4.5,
          layers: [layers.national],
          name: "scene 1"
        },
        scene2: {
          lat: 44,
          lng: -119,
          zoom: 5.25,
          layers: [layers.huc4],
          name: "scene 2"
        },
        scene3: {
          lat: 44.5701158,
          lng: -119,
          zoom: 5.25,
          layers: [layers.huc6],
          name: "scene 3"
        },
        scene4: {
          lat: 44,
          lng: -119,
          zoom: 5.25,
          layers: [layers.epa_choropleth],
          name: "scene 4"
        },
        scene5: {
          lat: 44.5701158,
          lng: -119,
          zoom: 5.25,
          layers: [layers.epa_choropleth, layers.usbr],
          name: "scene 5"
        },
        scene6: {
          lat: 38.6097,
          lng: -122.254,
          zoom: 11,
          layers: [layers.case_study_6, layers.hydro],
          name: "scene 6"
        },
        scene7: {
          lat: 38.6097,
          lng: -122.254,
          zoom: 9,
          layers: [layers.case_study_7, layers.hydro],
          name: "scene 7"
        },
        scene8: {
          lat: 38.6097,
          lng: -122.254,
          zoom: 9,
          layers: [layers.case_study_8, layers.hydro],
          name: "scene 8"
        },
        scene9: {
          lat: 38.6097,
          lng: -122.254,
          zoom: 9,
          layers: [layers.case_study_9, layers.hydro],
          name: "scene 9"
        },
        scene10: {
          lat: 39.5,
          lng: -98.35,
          zoom: 4.5,
          layers: [layers.national],
          name: "scene 10"
        }

      };

      $('#storymap').storymap({
        scenes: scenes,
        legend: true,
        loader: true,
        scalebar: true,
        scrolldown: false,
        progressline: true,
        navwidget: true,
        createMap: function () {
          var map = L.map($(".storymap-map")[0], {
            zoomControl: false,
            scrollWheelZoom: false
          });
          // add a base map
          L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png')
            .addTo(map);

          return map;
        }
      });

    } //end ready
  </script>
</body>

</html>