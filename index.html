<!doctype html>

<html lang="en">

<head>
  <title>Western Watersheds</title>

  <!--Requried meta tags-->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" />
  <!-- Animate CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alegreya+Sans+SC|Roboto" rel="stylesheet">>
  <!-- Storymap CSS -->
  <link rel="stylesheet" type="text/css" href="css/storymap.2.5.css">

  <!-- Add favicon for the web page -->
  <!--<link rel="icon" href="/images/favicon.ico" type="image/x-icon">-->

  <style>
    .feature-label {
      font-family: 'Roboto', sans-serif;
      color: black;
      font-size: 12px;
      font-weight: bold;
      text-shadow: 0 0 3pm #ffffff;
      background-color: rgba(0, 0, 0, 0);
      border: none;
      box-shadow: none;
    }

    .feature-tooltip {
      font-family: 'Roboto', sans-serif;
      color: black;
      font-size: 14px;
      font-weight: lighter;
    }

    .glyphicon-one-fine-smaller-dot:before {
      content: "\25cf";
      font-size: 1em;
    }

    .glow-effect {
      color: rgba(0, 255, 0, .6);
      text-shadow: 0 0 10pm rgb(0, 255, 0);
    }
  </style>

  <!-- Add libraries -->
  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.4.0.min.js"
    integrity="sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg=" crossorigin="anonymous"></script>
  <!-- Popper.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
  </script>
  <!-- Boostrap -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
  </script>
  <!-- Leaflet.ajax for asynchronously adding geojson data -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
  <!-- Chroma Lib -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.0.3/chroma.min.js"></script>
  <!-- Storymap Plugin-->
  <script src="js/storymap.2.4.js"></script>

</head>

<body>

  <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark storymap-navbar">
    <a class="navbar-brand" href="#">
      <!--convert the style value to a class and then add the class to the css file.-->
      <!--<img src="img/logo.png" class="d-inline-block align-top">-->
      Water Reclamation Projects & Biodiversity
    </a>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse">
      <!--Create class ml-auto for the navbar items you want on the right.-->
      <ul class="navbar-nav ml-auto"></ul>
    </div>
  </nav>

  <div class="container">
    <h1>Water Reclamation Projects & Biodiversity</h1>
    <h2>in Western Watersheds</h2>
  </div>


  <div id="storymap" class="container-fluid">
    <div class="row">
      <div class="col-sm-6 col-md-4 storymap-story">
        <section data-scene="scene1">
          <h2>Watersheds in the Western United States</h2>
          <p>definition & importance of watersheds - USGS, USBR info.</p>
        </section>
        <section data-scene="scene2">
          <h2>Watershed Administration</h2>
          <p>breakdown of administrative areas.</p>
        </section>
        <section data-scene="scene3">
          <h2>Watershed Health</h2>
          <p>introduce health of watersheds - stormwater runoff, polution, impact on environment.</p>
        </section>
        <section data-scene="scene4">
          <h2>Species at Risk</h2>
          <p>EPA data points discussion </p>
        </section>
        <section data-scene="scene5">
          <h2>Water Reclamation Projects</h2>
          <p>USBR projects/population growth/water management, etc.</p>
        </section>
        <section data-scene="scene6">
          <h2>Case Study: Lake Berryessa & Monticello Dam</h2>
          <p>blahblahblah</p>
        </section>
        <section data-scene="scene7">
            <h2>Case Study: Lake Berryessa & Monticello Dam</h2>
            <p>this will change once I get a working choropleth map. Maybe users should be able to select which layer they want to symbolize?</p>
          </section>
      </div>
      <div class="col-sm-6 col-md-8 storymap-map"></div>
    </div>
  </div>

  <script type="text/javascript">
    /// Scene One ///
    var huc2_legend = '<i style="background: black; opacity: 0.5"></i><p><b>Region: HUC2</b></p>';
    var huc2 = L.geoJson.ajax('./data/watersheds-huc2.geojson', {
      style: function (feature) {
        return {
          color: '#dddddd',
          weight: .75,
          fillOpacity: .1,
          fillColor: '#1f78b4'
        };
      }
    });

    /// Scene Two ///
    var huc4_legend = '<i style="background: black; opacity: 0.5"></i><p><b>Sub-Region: HUC4</b></p>';
    var huc4 = L.geoJson.ajax('./data/watersheds-huc4.geojson', {
      style: function (feature) {
        return {
          color: '#dddddd',
          weight: .5,
          fillOpacity: .2,
          fillColor: '#1f78b4'
        };
      }
    });

    /// Scene Three ///
    var huc8_legend = '<i style="background: black; opacity: 0.5"></i><p><b>Cataloguing Unit: HUC8</b></p>';
    var huc8 = L.geoJson.ajax('./data/epa-huc8.geojson', {
      style: function (feature) {
        return {
          color: '#dddddd',
          weight: .25,
          fillOpacity: .1,
          fillColor: '#1f78b4'
        };
      }
    });

    /// Scene Four ///
    // Style Choropleth Map
    function setColor(total) {
      // Tenary operation: condition ? valueIfTrue : valueIfFalse
      return total > 29 ? '#b30000' :
        total > 17 ? '#e34a33' :
        total > 9 ? '#fc8d59' :
        total > 4 ? '#fdcc8a' :
        '#fef0d9';
    }
    // Set style function that sets fill color property
    function style(feature) {
      return {
        fillColor: setColor(feature.properties.total),
        fillOpacity: 0.5,
        weight: .5,
        opacity: 0.8,
        color: '#ffffff',
      };
    }
    var epa_choropleth = L.geoJson.ajax('./data/epa-huc8.geojson', {
      style: style,
      onEachFeature: function (feature, layer) {
        layer.bindTooltip(feature.properties.Name, {
          className: 'feature-tooltip',
          permanent: false,
          direction: 'center'
        });
      }
    });
    var epa_choropleth_legend = '<p><b># of At Risk Species</b></p>' +
      '<i style="background: #fef0d9; opacity: 0.5"></i><p><b>0 - 4</b></p>' +
      '<i style="background: #fdcc8a; opacity: 0.5"></i><p><b>5 - 9</b></p>' +
      '<i style="background: #fc8d59; opacity: 0.5"></i><p><b>10 - 17</b></p>' +
      '<i style="background: #e34a33; opacity: 0.5"></i><p><b>18 - 29</b></p>' +
      '<i style="background: #b30000; opacity: 0.5"></i><p><b>30 - 49</b></p>';

    /// Scene Five ///
    var usbr_legend = '<i style="background: black; opacity: 0.5"></i><p><b>USBR Water Reclamation Projects</b></p>';
    var usbr = L.geoJson.ajax('./data/usbrpoints.geojson', {
      style: function (feature) {
        return {
          radius: 8, //this isn't working...yet!
          fillColor: chroma.random(),
          fillOpacity: 0.5,
          stroke: true,
          weight: 1,
          opacity: 0.8,
          color: '#ffffff',
        };
      },
      pointToLayer: function (feature, latlng) {
        return L.circle(latlng);
      },
      onEachFeature: function (feature, layer) {
        layer.bindTooltip(feature.properties.description + "<br>" + "Type: " +
        feature.properties.type, {
          sticky: true,
          className: "feature-tooltip"
        });
      }
    });

    /// Scene Six ///
    var case_study_plain_legend = '<i style="background: black; opacity: 0.5"></i><p><b>Central California</b></p>';
    var case_study_plain = L.geoJson.ajax('./data/case_study.geojson', {
      style: function (feature) {
        return {
          color: '#dddddd',
          weight: .75,
          fillOpacity: .3,
          fillColor: '#1f78b4'
        };
      }
    });

   /// Fake Scene Seven ///
   var case_study_plain_legend = '<i style="background: black; opacity: 0.5"></i><p><b>Central California</b></p>';
    var case_study_plain = L.geoJson.ajax('./data/case_study.geojson', {
      style: function (feature) {
        return {
          color: '#dddddd',
          weight: .75,
          fillOpacity: .3,
          fillColor: '#1f78b4'
        };
      }
    });

    // /// Scene Seven That Doesn't Work and Breaks Scene Four UGH///
    //  // style choropleth case study map
    //  function setColor(rare_ecosystem) {
    //   // Tenary operation: condition ? valueIfTrue : valueIfFalse
    //   return total > 6.1771 ? '#006837' :
    //     total > 2.4212 ? '#31a354' :
    //     total > 0.8123 ? '#78c679' :
    //     total > 0.2414 ? '#c2e699' :
    //     '#ffffee';
    // }
    // // Set style function that sets fill color property
    // function style(feature) {
    //   return {
    //     fillColor: setColor(feature.properties.rare_ecosystem),
    //     fillOpacity: 0.2,
    //     weight: .02,
    //     opacity: 0.8,
    //     color: '#ffffff',
    //   };
    // }
    // var case_study = L.geoJson.ajax('./data/case_study.geojson', {
    //   style: style,
    //   onEachFeature: function (feature, layer) {
    //     layer.bindTooltip(feature.properties.Name, {
    //       className: 'feature-tooltip',
    //       permanent: false,
    //       direction: 'center'
    //     });
    //   }
    // });
    // var case_study_legend = '<p><b>Percentage Rare Ecosystems in Watershed</b></p>' +
    //   '<i style="background: #ffffee; opacity: 0.5"></i><p><b>0 - .24 </b></p>' +
    //   '<i style="background: #c2e699; opacity: 0.5"></i><p><b>.25 - .81</b></p>' +
    //   '<i style="background: #78c679; opacity: 0.5"></i><p><b>0.82 - 2.42</b></p>' +
    //   '<i style="background: #31a354; opacity: 0.5"></i><p><b>2.43 - 6.17</b></p>' +
    //   '<i style="background: #006837; opacity: 0.5"></i><p><b>6.18 - 9.21</b></p>';


    /// End of Scenes ///

    var darkLayer = L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png');

    var layers = {
      huc2: {
        layer: huc2,
        legend: huc2_legend
      },
      huc4: {
        layer: huc4,
        legend: huc4_legend
      },
      huc8: {
        layer: huc8,
        legend: huc8_legend
      },
      epa_choropleth: {
        layer: epa_choropleth,
        legend: epa_choropleth_legend
      },
      usbr: {
        layer: usbr,
        legend: usbr_legend
      },
      case_study_plain: {
        layer: case_study_plain,
        legend: case_study_plain_legend
      },
      case_study: {
        layer: case_study_plain,
        case_study_plain_legend
      }
    }

    var scenes = {
      scene1: {
        lat: 44,
        lng: -119,
        zoom: 5,
        layers: [layers.huc2],
        name: "scene 1"
      },
      scene2: {
        lat: 44.5701158,
        lng: -119,
        zoom: 5,
        layers: [layers.huc4],
        name: "scene 2"
      },
      scene3: {
        lat: 44.5701158,
        lng: -119,
        zoom: 5,
        layers: [layers.huc8],
        name: "scene 3"
      },
      scene4: {
        lat: 44,
        lng: -119,
        zoom: 5,
        layers: [layers.epa_choropleth],
        name: "scene 4"
      },
      scene5: {
        lat: 44.5701158,
        lng: -119,
        zoom: 5,
        layers: [layers.huc4, layers.usbr],
        name: "scene 5"
      },
      scene6: {
        lat: 38.6097,
        lng: -122.254,
        zoom: 10,
        layers: [layers.case_study],
        name: "scene 6"
      },
      scene7: {
        lat: 38.6097,
        lng: -122.254,
        zoom: 10,
        layers: [layers.case_study],
        name: "scene 7"
      }
    };
    $('#storymap').storymap({
          scenes: scenes,
          legend: true,
          loader: true,
          scalebar: true,
          scrolldown: false,
          progressline: true,
          navwidget: true,
          createMap: function () {
            var map = L.map($(".storymap-map")[0], {
              zoomControl: false,
              scrollWheelZoom: false
            });
            // add an base map
            L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png')
              .addTo(map);

            return map;
          }
          });
  </script>
</body>

</html>